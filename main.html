<!doctype html>

<html lang="en">
	<meta charset="utf-8">
	
	<head>
		<title> GIS Web App </title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		
		<!-- TODO: Move to a separate .css file -->
		<style>
			#title {
				text-align: center;
				height: 100px;
				line-height: 100px;
			}

			.container {
				max-width: 800px;
				margin-left: auto;
				margin-right: auto;
			}

			#map-container {
				margin-right: auto;
				margin-left: auto;
				width: 640%px;
				height: 480px;
			}

			#cpanel {
				height: 100%;
			}
		</style>

		<!-- Load API from Google Map along with the places library (in the GET request) -->
		<script src="http://maps.googleapis.com/maps/api/js?libraries=places"></script>

		<!-- Load JQuery API! -->
		<script src="js/jquery-3.0.0.min.js"> </script>

		<!-- JQuery validation plugin -->
		<script src="js/jquery.validate.js"></script>

		<script>
			/* Global variables */
			var map;
			var places_service;
			var mode_input = false;
			var the_marker;

			/* Will be called after the page has been loaded */
			function init() {
				/* Initialize map variable */
				map = new google.maps.Map(
					document.getElementById("map-container"), /* Container element */
					{
						zoom: 16, disableDefaultUI: true
					}
				);

				/* Initialize the marker */
				the_marker = new google.maps.Marker({map: map});

				/* Handle clicks on map */
				map.addListener('click', function(e) {
					
					the_marker.setPosition(e.latLng);

					/* Set value of inputs in control panel */
					$('#input_lat').val(
						e.latLng.lat()
					);

					$('#input_lng').val(
						e.latLng.lng()
					);
				});



				/* Initialize places service */
				places_service = new google.maps.places.PlacesService(map);

				setPlaceByString("Sungai Raya Dalam");
			}

			function setPlaceByString(place_name) {
				places_service.textSearch(
					// Request description
					{	query: place_name	},

					// Callback function
					function(result, status) {
						position = result[0].geometry.location;
						map.setCenter(position);
					}
				);
			}

			
			$(document).ready(function() {
				/* Initialize Google Map related stuff */
				init();

				/* Handle events */
				$("#add_waypoint").click(function(e) {
					/* Prevent the default action of loading another page when submit button is clicked. */
					e.preventDefault();

					$("#add_waypoint_form").validate();
					if ($("#add_waypoint_form").valid()) {
						/* Send ajax request to webserver */
						$.ajax({
							type: "POST",
							url: "/add_waypoint",
							data: {
								name: $("#input_name").val(),
								lat: $("#input_lat").val(),
								lng: $("#input_lng").val(),
								desc: $("#input_desc").val()
							},

							/* Callback function */
							success: function(result) {
								alert(result);

								$("#records").html(result);
							}

						});
					}

				});
			});

		</script>
	</head>

	<body>
		<div class="container">

			<h1 id="title"> Peta Reklame Sungai Raya Dalam </h1>

			<div class="row">

				<div class="col-md-4" id="cpanel">
					<div class="panel panel-default">
						<div class="panel-heading">
							Panel Kendali
						</div>
						<div class="panel-body">
							<form id="add_waypoint_form">
								<div class="form-group">
									<label for="input_name"> Nama Lokasi: </label>
									<input class="form-control" placeholder="Nama lokasi" type="text" id="input_name" required>
								</div>
								<div class="form-group">
									<label for="input_lat"> Garis Bujur: </label>
									<input class="form-control" placeholder="Posisi garis bujur" type="text" id="input_lat" required>
								</div>
								<div class="form-group">
									<label for="input_lng"> Garis Lintang: </label>
									<input class="form-control" placeholder="Posisi garis lintang" type="text" id="input_lng" required>
								</div>

								<div class="form-group">
									<label for="input_desc"> Keterangan: </label>
									<textarea id="input_desc" class="form-control" rows="3" required></textarea>
								</div>

								<div style='text-align: right'>
									<input style="width: 100%" id="add_waypoint" class='btn btn-primary' type='submit' value='Simpan Data Lokasi'>
								</div>
							</form>

							<div style='display: block;'>
								<hr>
							</div>


						</div>
					</div>
				</div>

				<div class="col-md-8">	
					<div class="panel panel-default">
						<div class="panel-body">
							<!-- Map panel body -->
							
							<div id="map-container">
								<!-- Contains the map loaded using Google Map API -->
							</div>

						</div>
					</div>

					
				</div>
			</div>

			<div class="row">
				<div class="col-md-12">

			
				

					<div class="panel panel-default">
						<div class="panel-body">
							<table class="table table-striped">
								<thead>	<tr>	<th> Nama Lokasi </th>	<th> Posisi Lintang </th>	<th> Posisi Bujur </th>	<th> Keterangan </th> </tr>	</thead>
								
								<tbody id="records">
									{% for record in records %}
										<tr>	<td> {{ record[0] }} </td> <td> {{ record[1] }} </td>	<td> {{ record[2] }} </td> <td> {{ record[3] }}  </td>  </tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>

</html>